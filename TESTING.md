# Инструкции по тестированию приложения на iPhone

## Быстрый старт

### Процесс обновления приложения (5-10 минут):

1. **Внесите изменения в Cursor**
2. **Запустите скрипт обновления:**
   ```powershell
   .\update-app.ps1
   ```
   Или вручную:
   ```powershell
   git add .
   git commit -m "Ваше сообщение"
   git push
   ```
3. **Дождитесь сборки** (5-10 минут)
   - Откройте: https://github.com/Progress-collab/moscow-time-ios/actions
   - Дождитесь зеленой галочки ✅
4. **Скачайте IPA файл:**
   - Откройте: https://github.com/Progress-collab/moscow-time-ios/releases
   - Скачайте последний Release (файл `MoscowTime.ipa`)
5. **Установите на iPhone через AltStore:**
   - Подключите iPhone к компьютеру
   - Откройте AltStore на компьютере
   - Откройте AltStore на iPhone
   - Нажмите "+" → выберите скачанный IPA файл
   - Дождитесь установки

## Подробные инструкции

### 1. Первоначальная настройка AltStore

#### На компьютере (Windows):

1. **Установите iTunes** (не из Microsoft Store!)
   - Скачайте с: https://www.apple.com/itunes/download/
   - Установите и перезагрузите компьютер

2. **Установите AltServer:**
   - Скачайте с: https://altstore.io/
   - Установите AltServer
   - Запустите AltServer (иконка появится в системном трее)

3. **Подключите iPhone:**
   - Используйте оригинальный USB кабель
   - На iPhone: "Доверять этому компьютеру?" → **Доверять**
   - Разблокируйте iPhone

4. **Установите AltStore на iPhone:**
   - В системном трее Windows найдите иконку AltServer
   - Правый клик → "Install AltStore" → выберите ваш iPhone
   - Введите Apple ID и пароль
   - AltStore установится на iPhone

#### На iPhone:

1. **Доверьте разработчика:**
   - Настройки → Основные → VPN и управление устройством
   - Найдите ваш Apple ID email
   - Нажмите → "Доверить [ваш email]"

2. **Включите режим разработчика** (если требуется):
   - Настройки → Конфиденциальность и безопасность
   - Прокрутите вниз до "Режим разработчика"
   - Включите переключатель
   - Перезагрузите iPhone (если запросит)

### 2. Процесс обновления приложения

#### Шаг 1: Изменения в Cursor

Внесите изменения в код:
- `MoscowTime/ContentView.swift` - UI приложения
- `MoscowTime/MoscowTimeApp.swift` - точка входа
- Другие файлы проекта

#### Шаг 2: Обновление через скрипт

**Быстрый способ (рекомендуется):**
```powershell
.\update-app.ps1
```

Скрипт автоматически:
- Проверит изменения
- Добавит все файлы в git
- Создаст коммит (запросит сообщение)
- Отправит в GitHub

**С автоматическим открытием GitHub Actions:**
```powershell
.\update-app.ps1 -OpenActions
```

**С указанием сообщения коммита:**
```powershell
.\update-app.ps1 -Message "Исправлена ошибка отображения времени"
```

**Ручной способ:**
```powershell
git add .
git commit -m "Ваше сообщение"
git push
```

#### Шаг 3: Ожидание сборки

1. Откройте: https://github.com/Progress-collab/moscow-time-ios/actions
2. Найдите последний workflow run
3. Дождитесь завершения (зеленая галочка ✅)
   - Обычно занимает 5-10 минут
   - Можно отслеживать прогресс в реальном времени

#### Шаг 4: Скачивание IPA

1. Откройте: https://github.com/Progress-collab/moscow-time-ios/releases
2. Найдите последний Release (самый верхний)
3. Нажмите на файл `MoscowTime.ipa` для скачивания
4. Сохраните файл в удобное место (например, Desktop)

#### Шаг 5: Установка через AltStore

**На компьютере:**
1. Убедитесь, что AltServer запущен (иконка в системном трее)
2. Подключите iPhone к компьютеру через USB
3. Разблокируйте iPhone

**На iPhone:**
1. Откройте приложение AltStore
2. Перейдите на вкладку "My Apps"
3. Нажмите кнопку "+" в верхнем левом углу
4. Выберите "Install from Files" или "Install from URL"
5. Если "Install from Files":
   - Найдите скачанный IPA файл
   - Выберите его
6. Дождитесь установки (обычно 1-2 минуты)
7. После установки приложение появится на главном экране

**Альтернатива через компьютер:**
1. Откройте AltServer на компьютере
2. Правый клик на иконку → "Install AltStore" → выберите iPhone
3. Выберите IPA файл
4. Введите Apple ID (если запросит)

### 3. Проверка работы приложения

После установки:

1. **Найдите приложение на главном экране:**
   - Иконка "Москва" должна быть видна

2. **Запустите приложение:**
   - Нажмите на иконку
   - Приложение должно открыться без ошибок

3. **Проверьте функциональность:**
   - ✅ Отображается день недели на русском
   - ✅ Показывается время в формате HH:mm:ss
   - ✅ Отображается полная дата
   - ✅ Время обновляется каждую секунду
   - ✅ Время соответствует московскому времени

4. **Проверьте иконку:**
   - На главном экране должна быть кастомная иконка (градиентный фон, часы, буква "М")

### 4. Регулярное обновление сертификата (раз в неделю)

**Важно:** Приложения, установленные через AltStore с бесплатным Apple ID, требуют обновления сертификата каждые 7 дней.

#### Процесс обновления:

1. **Подключите iPhone к компьютеру:**
   - Используйте USB кабель
   - Убедитесь, что AltServer запущен на компьютере

2. **Откройте AltStore на iPhone:**
   - Приложение автоматически обновит сертификаты при подключении к компьютеру

3. **Или обновите вручную:**
   - Откройте AltStore на iPhone
   - Перейдите на вкладку "My Apps"
   - Нажмите "Refresh All" (если доступно)

4. **Проверьте статус:**
   - Если приложение работает нормально - всё в порядке
   - Если приложение не запускается - переустановите его через AltStore

### 5. Быстрый цикл разработки

Для быстрого тестирования изменений:

```powershell
# 1. Внесите изменения в Cursor
# 2. Обновите приложение
.\update-app.ps1 -Message "Быстрое тестирование"

# 3. Подождите 5-10 минут (можно отслеживать в GitHub Actions)

# 4. Скачайте IPA с Releases

# 5. Установите через AltStore (2-3 минуты)

# Итого: ~15-20 минут от изменения до тестирования на iPhone
```

## Troubleshooting (Решение проблем)

### Проблема: Приложение не запускается после установки

**Решение:**
1. Проверьте режим разработчика:
   - Настройки → Конфиденциальность и безопасность → Режим разработчика
   - Должен быть включен

2. Проверьте доверие разработчика:
   - Настройки → Основные → VPN и управление устройством
   - Найдите ваш Apple ID → Доверьте

3. Переустановите приложение:
   - Удалите старое приложение
   - Установите заново через AltStore

### Проблема: AltStore не видит iPhone

**Решение:**
1. Проверьте подключение:
   - Убедитесь, что кабель подключен правильно
   - Попробуйте другой USB порт
   - Попробуйте другой кабель

2. Проверьте iTunes:
   - Убедитесь, что iTunes установлен (не из Microsoft Store)
   - Перезапустите iTunes

3. Перезапустите службы:
   - Откройте "Службы" (services.msc)
   - Найдите "Apple Mobile Device Service"
   - Правый клик → Перезапустить

4. Перезапустите AltServer:
   - Закройте AltServer полностью
   - Запустите заново
   - Подключите iPhone снова

### Проблема: Ошибка при установке через AltStore

**Решение:**
1. Проверьте Apple ID:
   - Убедитесь, что вводите правильный Apple ID и пароль
   - Если включена двухфакторная аутентификация, создайте пароль приложения:
     - https://appleid.apple.com/ → Пароли приложений

2. Проверьте интернет:
   - Убедитесь, что iPhone подключен к интернету
   - AltStore требует интернет для создания сертификата

3. Попробуйте другой способ:
   - Используйте Sideloadly вместо AltStore
   - Или установите через AltServer на компьютере

### Проблема: Сборка не запускается в GitHub Actions

**Решение:**
1. Проверьте статус:
   - Откройте: https://github.com/Progress-collab/moscow-time-ios/actions
   - Посмотрите последний workflow run

2. Проверьте ошибки:
   - Если есть красный крестик ❌, откройте workflow run
   - Посмотрите логи для выявления проблемы

3. Проверьте код:
   - Убедитесь, что нет синтаксических ошибок в Swift
   - Проверьте, что все файлы закоммичены

4. Запустите вручную:
   - В GitHub Actions нажмите "Run workflow"
   - Выберите ветку main
   - Нажмите "Run workflow"

### Проблема: IPA файл не скачивается

**Решение:**
1. Проверьте Releases:
   - Убедитесь, что Release создан успешно
   - Проверьте, что сборка завершилась успешно

2. Попробуйте другой браузер:
   - Иногда помогает смена браузера

3. Проверьте файл:
   - Убедитесь, что файл имеет расширение .ipa
   - Размер должен быть несколько мегабайт

### Проблема: Время отображается неправильно

**Решение:**
1. Проверьте часовой пояс iPhone:
   - Настройки → Основные → Дата и время
   - Убедитесь, что "Автоматически" включено

2. Проверьте код:
   - Убедитесь, что используется TimeZone "Europe/Moscow"
   - Проверьте форматирование даты

3. Перезапустите приложение:
   - Закройте приложение полностью
   - Запустите заново

## Полезные ссылки

- **GitHub Actions:** https://github.com/Progress-collab/moscow-time-ios/actions
- **Releases:** https://github.com/Progress-collab/moscow-time-ios/releases
- **AltStore:** https://altstore.io/
- **Sideloadly:** https://sideloadly.io/
- **Apple Developer:** https://developer.apple.com/

## Советы

1. **Регулярно обновляйте сертификат:**
   - Подключайте iPhone к компьютеру раз в неделю
   - AltStore автоматически обновит сертификаты

2. **Храните IPA файлы:**
   - Скачивайте IPA файлы с GitHub Releases
   - Храните их в облаке для резервной копии

3. **Отслеживайте сборки:**
   - Используйте `.\update-app.ps1 -OpenActions` для автоматического открытия GitHub Actions
   - Настройте уведомления GitHub для отслеживания сборок

4. **Тестируйте часто:**
   - Делайте небольшие изменения и тестируйте сразу
   - Это помогает быстро находить и исправлять ошибки

5. **Используйте скрипт обновления:**
   - `update-app.ps1` экономит время и уменьшает ошибки
   - Добавьте его в PATH для использования из любой директории

## Часто задаваемые вопросы

**Q: Как часто нужно обновлять сертификат?**
A: Раз в 7 дней при использовании бесплатного Apple ID. При использовании платного Apple Developer аккаунта - раз в год.

**Q: Можно ли тестировать приложение без iPhone?**
A: Нет, для тестирования нативного iOS приложения нужен реальный iPhone или Mac с симулятором.

**Q: Сколько времени занимает обновление приложения?**
A: Обычно 15-20 минут: сборка (5-10 мин) + скачивание и установка (2-3 мин).

**Q: Что делать, если потерял компьютер?**
A: Скачайте IPA файл с GitHub Releases и установите через Sideloadly на новом компьютере.

**Q: Можно ли использовать другой способ установки?**
A: Да, можно использовать Sideloadly вместо AltStore. Процесс аналогичный.

